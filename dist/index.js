!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("XWatermark",[],t):"object"==typeof exports?exports.XWatermark=t():e.XWatermark=t()}(window,(function(){return function(e){var t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(o,r,function(t){return e[t]}.bind(null,r));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";function o(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,t||"default");if("object"!=typeof o)return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n.r(t),n.d(t,"XWatermark",(function(){return d}));const r="x-watermark",i="[Watermark]",a={id:r,top:0,left:0,rows:0,cols:0,xSpace:50,ySpace:50,ratio:1,font:"Helvetica Neue, Arial, MS YaHei",weight:"normal",color:"black",fontsize:16,alpha:.1,angle:-15,zIndex:9999,width:"auto",height:"auto",mode:"n",parentNode:document.body,parentSelector:"",observer:!1,observerNode:null,prevent:!1};function s(e){const t=document.getElementById(e);if(t){try{const e=t.parentNode;return null==e||e.removeChild(t),!0}catch(t){console.warn(`${i} Remove watermark dom [${e}] failed:`,t)}return!1}return!0}function l(e,t){e.font=`${t.weight} ${t.fontsize}px ${t.font}`,e.fillStyle=t.color,e.textAlign="left",e.textBaseline="bottom"}const c=(e,t)=>{const n=t.id||r,o=(t.parentSelector?document.querySelector(t.parentSelector):t.parentNode)||document.body;s(n);const a=1.5*t.fontsize;let c=t.xSpace,u=t.ySpace;["stagger","s"].includes(t.mode)&&(c=2*t.xSpace,u=2*t.ySpace);const d=document.createElement("canvas"),h=d.getContext("2d");if(null===h)return console.error(`${i} load error. Canvas Context is null. You'r browser may not support canvas.`),"";if(l(h,t),"string"==typeof t.width){const n=Number(t.width);if(isNaN(n)){if("auto"!==t.width)return console.warn(`${i} width is not a number or 'auto'. Please check your options.`),"";{const n=h.measureText(e);t.width=n.width+a*Math.sin(Math.abs(t.angle)*Math.PI/180)}}else t.width=n*t.ratio}if("string"==typeof t.height){const n=Number(t.height);if(isNaN(n)){if("auto"!==t.height)return console.warn(`${i} height is not a number or 'auto'. Please check your options.`),"";{const n=((e,t,n)=>{const o=t.split("");let r="",i=0;for(let t=0;t<o.length;t++){const a=r+o[t];e.measureText(a).width>n&&t>0?(i++,r=o[t]):r=a}return++i})(h,e,t.width);t.height=a*n+t.width*Math.sin(Math.abs(t.angle)*Math.PI/180)}}else t.height=n*t.ratio}const p=window.devicePixelRatio||1;d.width=(t.width+c)*p,d.height=(t.height+u)*p,h.scale(p,p),l(h,t),function(e,t,n,o,r,i,a){e.save(),e.translate(n,o),e.rotate(a*Math.PI/180);const s=t.split("");let l="";const c=i*Math.sin(a*Math.PI/180);let u=a<0?-1:0;for(let t=0;t<s.length;t++){const n=l+s[t];e.measureText(n).width>r&&t>0?(e.fillText(l,c*u++,0),l=s[t],e.translate(0,i)):l=n}e.fillText(l,c*u,0),e.restore()}(h,e,0,(t.angle<0?1:0)*t.width*Math.sin(Math.abs(t.angle)*Math.PI/180)+.8*a,t.width,a,t.angle);const b=d.toDataURL("image/png");o===document.body||""!==o.style.position&&"static"!==o.style.position||(o.style.position="relative");const m=document.createElement("div");m.id=n,m.classList.add("watermark-container"),m.style.pointerEvents="none",m.style.overflow="hidden",m.style.top="0",m.style.left="0",m.style.margin="0",m.style.padding="0",m.style.position=o===document.body?"fixed":"absolute",m.style.zIndex=`${t.zIndex}`,m.style.opacity=`${t.alpha}`,m.style.paddingTop=`${t.top}px`,m.style.paddingLeft=`${t.left}px`,m.style.width=(o.clientWidth||document.documentElement.clientWidth)-t.left+"px",m.style.height=(o.clientHeight||document.documentElement.clientHeight)-t.top+"px";const f=document.createElement("div");switch(f.classList.add("watermark-content"),f.style.width="100%",f.style.height="100%",f.style.margin="0",f.style.padding="0",f.style.backgroundImage=`url(${b})`,f.style.backgroundPosition="0 0",t.mode){case"horizontal":case"h":case"x":f.style.backgroundRepeat="repeat-x";break;case"vertical":case"v":case"y":f.style.backgroundRepeat="repeat-y";break;case"stagger":case"s":f.style.backgroundImage=`url(${b}), url(${b})`,f.style.backgroundRepeat="repeat, repeat",f.style.backgroundPosition=`0 0, ${(t.width+c)/2}px ${(t.height+u)/2}px`;break;default:f.style.backgroundRepeat="repeat"}return f.style.backgroundSize=`${t.width+c}px ${t.height+u}px`,m.appendChild(f),o.appendChild(m),b};class u{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(o(this,"_observerObs",null),o(this,"_preventObs",null),o(this,"base64",""),o(this,"content",""),o(this,"_options",Object.assign({},a)),e)return this.init(e,t)}init(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this._options=Object.assign({},a,t),this.content=e,"loading"===document.readyState?document.addEventListener("DOMContentLoaded",(()=>this._do())):this._do(),window.addEventListener("resize",(()=>this._do())),this}reload(e,t){return t&&"object"==typeof t&&(this._options=Object.assign({},a,t)),this.remove(),this.init(e||this.content,this._options)}remove(){return this._dispose(),s(this._options.id)}_do(){const e=Object.assign({},this._options);if("number"==typeof e.ratio&&1!==e.ratio&&(e.top*=e.ratio,e.left*=e.ratio,e.xSpace*=e.ratio,e.ySpace*=e.ratio,e.fontsize*=e.ratio,"number"==typeof e.width&&(e.width*=e.ratio),"number"==typeof e.height&&(e.height*=e.ratio)),this.base64=c(this.content,e),e.observer){const t=window.MutationObserver||window.WebKitMutationObserver;if(t){this._observerObs=new t((e=>{e.forEach((e=>{"attributes"===e.type&&("clientWidth"!==e.attributeName&&"clientHeight"!==e.attributeName&&"style"!==e.attributeName||this.reload())}))}));const n=e.observerNode||(e.parentSelector?document.querySelector(e.parentSelector):e.parentNode);this._observerObs.observe(n,{attributes:!0})}else console.warn(`${i} You have set 'options.observer', but it seems that your current env does not support MutationObserver. You may need to refresh manually.`)}if(e.prevent){const t=window.MutationObserver||window.WebKitMutationObserver;if(t){this._preventObs=new t((e=>{e.forEach((e=>{("attributes"===e.type&&"style"===e.attributeName&&(e.target.className.includes("watermark-container")||e.target.className.includes("watermark-content"))||"attributes"===e.type&&"class"===e.attributeName&&e.oldValue&&(e.oldValue.includes("watermark-container")||e.oldValue.includes("watermark-content"))||"childList"===e.type&&e.removedNodes.length>0&&Array.from(e.removedNodes).filter((e=>e.className.includes("watermark-container")||e.className.includes("watermark-content"))).length>0)&&this.reload()}))}));const n=(e.parentSelector?document.querySelector(e.parentSelector):e.parentNode)||document.body;this._preventObs.observe(n,{attributes:!0,subtree:!0,childList:!0,characterData:!0,attributeOldValue:!0,characterDataOldValue:!0,attributeFilter:["style","class"]})}else console.warn(`${i} You have set 'options.prevent', but it seems that your current env does not support MutationObserver. You may need to do it manually.`)}}_dispose(){this._observerObs&&(this._observerObs.disconnect(),this._observerObs=null),this._preventObs&&(this._preventObs.disconnect(),this._preventObs=null),window.removeEventListener("resize",(()=>this._do()))}}const d=u;t.default=u}])}));