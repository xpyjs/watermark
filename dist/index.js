!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("XWatermark",[],e):"object"==typeof exports?exports.XWatermark=e():t.XWatermark=e()}(window,(function(){return function(t){var e={};function n(i){if(e[i])return e[i].exports;var o=e[i]={i:i,l:!1,exports:{}};return t[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(i,o,function(e){return t[e]}.bind(null,o));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=0)}([function(t,e,n){"use strict";function i(t,e,n){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var i=n.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}n.r(e),n.d(e,"XWatermark",(function(){return d}));const o="x-watermark",r={id:o,top:0,left:0,rows:0,cols:0,xSpace:50,ySpace:50,ratio:1,font:"Helvetica Neue, Arial, MS YaHei",weight:"normal",color:"black",fontsize:16,alpha:.1,angle:-15,zIndex:9999,width:"auto",height:"auto",mode:"n",parentNode:document.body,parentSelector:"",observer:!1,observerNode:null,prevent:!1};function s(t){const e=document.getElementById(t);if(e){try{const t=e.parentNode;return null==t||t.removeChild(e),!0}catch(t){}return!1}return!0}function a(t,e){t.font=`${e.weight} ${e.fontsize}px ${e.font}`,t.fillStyle=e.color,t.textAlign="left",t.textBaseline="bottom"}const l=(t,e)=>{const n=e.id||o,i=(e.parentSelector?document.querySelector(e.parentSelector):e.parentNode)||document.body;s(n);const r=1.5*e.fontsize;let l=e.xSpace,c=e.ySpace;["stagger","s"].includes(e.mode)&&(l=2*e.xSpace,c=2*e.ySpace);const d=document.createElement("canvas"),u=d.getContext("2d");if(null===u)return"";if(a(u,e),"string"==typeof e.width){const n=Number(e.width);if(isNaN(n)){if("auto"!==e.width)return"";{const n=u.measureText(t);e.width=n.width+r*Math.sin(Math.abs(e.angle)*Math.PI/180)}}else e.width=n*e.ratio}if("string"==typeof e.height){const n=Number(e.height);if(isNaN(n)){if("auto"!==e.height)return"";{const n=((t,e,n)=>{const i=e.split("");let o="",r=0;for(let e=0;e<i.length;e++){const s=o+i[e];t.measureText(s).width>n&&e>0?(r++,o=i[e]):o=s}return++r})(u,t,e.width);e.height=r*n+e.width*Math.sin(Math.abs(e.angle)*Math.PI/180)}}else e.height=n*e.ratio}const h=window.devicePixelRatio||1;d.width=(e.width+l)*h,d.height=(e.height+c)*h,u.scale(h,h),a(u,e),function(t,e,n,i,o,r,s){t.save(),t.translate(n,i),t.rotate(s*Math.PI/180);const a=e.split("");let l="";const c=r*Math.sin(s*Math.PI/180);let d=s<0?-1:0;for(let e=0;e<a.length;e++){const n=l+a[e];t.measureText(n).width>o&&e>0?(t.fillText(l,c*d++,0),l=a[e],t.translate(0,r)):l=n}t.fillText(l,c*d,0),t.restore()}(u,t,0,(e.angle<0?1:0)*e.width*Math.sin(Math.abs(e.angle)*Math.PI/180)+.8*r,e.width,r,e.angle);const p=d.toDataURL("image/png");i===document.body||""!==i.style.position&&"static"!==i.style.position||(i.style.position="relative");const b=document.createElement("div");b.id=n,b.style.pointerEvents="none",b.style.overflow="hidden",b.style.top="0",b.style.left="0",b.style.margin="0",b.style.padding="0",b.style.position=i===document.body?"fixed":"absolute",b.style.zIndex=`${e.zIndex}`,b.style.opacity=`${e.alpha}`,b.style.paddingTop=`${e.top}px`,b.style.paddingLeft=`${e.left}px`,b.style.width=(i.clientWidth||document.documentElement.clientWidth)-e.left+"px",b.style.height=(i.clientHeight||document.documentElement.clientHeight)-e.top+"px";const f=document.createElement("div");switch(f.style.width="100%",f.style.height="100%",f.style.margin="0",f.style.padding="0",f.style.backgroundImage=`url(${p})`,f.style.backgroundPosition="0 0",e.mode){case"horizontal":case"h":case"x":f.style.backgroundRepeat="repeat-x";break;case"vertical":case"v":case"y":f.style.backgroundRepeat="repeat-y";break;case"stagger":case"s":f.style.backgroundImage=`url(${p}), url(${p})`,f.style.backgroundRepeat="repeat, repeat",f.style.backgroundPosition=`0 0, ${(e.width+l)/2}px ${(e.height+c)/2}px`;break;default:f.style.backgroundRepeat="repeat"}return f.style.backgroundSize=`${e.width+l}px ${e.height+c}px`,b.appendChild(f),i.appendChild(b),p};class c{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(i(this,"_observerObs",null),i(this,"_preventObs",null),i(this,"base64",""),i(this,"content",""),i(this,"_options",Object.assign({},r)),t)return this.init(t,e)}init(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this._options=Object.assign({},r,e),this.content=t,"loading"===document.readyState?document.addEventListener("DOMContentLoaded",(()=>this._do())):this._do(),window.addEventListener("resize",(()=>this._do())),this}reload(t,e){return e&&"object"==typeof e&&(this._options=Object.assign({},r,e)),this.remove(),this.init(t||this.content,this._options)}remove(){return this._dispose(),s(this._options.id)}_do(){const t=Object.assign({},this._options);if("number"==typeof t.ratio&&1!==t.ratio&&(t.top*=t.ratio,t.left*=t.ratio,t.xSpace*=t.ratio,t.ySpace*=t.ratio,t.fontsize*=t.ratio,"number"==typeof t.width&&(t.width*=t.ratio),"number"==typeof t.height&&(t.height*=t.ratio)),this.base64=l(this.content,t),t.observer){const e=window.MutationObserver||window.WebKitMutationObserver;if(e){this._observerObs=new e((t=>{t.forEach((t=>{"attributes"===t.type&&("clientWidth"!==t.attributeName&&"clientHeight"!==t.attributeName&&"style"!==t.attributeName||this.reload())}))}));const n=t.observerNode||(t.parentSelector?document.querySelector(t.parentSelector):t.parentNode);this._observerObs.observe(n,{attributes:!0})}}if(t.prevent){const e=window.MutationObserver||window.WebKitMutationObserver;if(e){this._preventObs=new e((e=>{e.forEach((e=>{e.target.id===t.id?this.reload():"childList"===e.type&&Array.from(e.removedNodes||[]).find((e=>e.id===t.id))&&(document.getElementById(t.id)||this.reload())}))}));const n=(t.parentSelector?document.querySelector(t.parentSelector):t.parentNode)||document.body;this._preventObs.observe(n,{attributes:!0,subtree:!0,childList:!0,characterData:!0,attributeOldValue:!0,characterDataOldValue:!0,attributeFilter:["style"]})}}}_dispose(){this._observerObs&&(this._observerObs.disconnect(),this._observerObs=null),this._preventObs&&(this._preventObs.disconnect(),this._preventObs=null),window.removeEventListener("resize",(()=>this._do()))}}const d=c;e.default=c}])}));